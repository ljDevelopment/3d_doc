<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
    [data-tags*="level0"] {
        color: rgb(0, 0, 0);
    }

    /* Estilo para los elementos con data-set="1" */
    [data-tags*="level1"] {
        color: rgb(107, 107, 107);
    }

    img {
        max-height: 40vh;
    }
</style>

<body>

    <script>

        const info = {
            'info': 'Metodología montessori',
            'tags': ['level0'],
            'pieces': [
                {
                    'info': 'Etapas%20del%20desarrollo%20144422e221e78065815bc2e0cc22ad3d/image.png',
                    'type': 'image',
                    'tags' : ['level0']
                },
                {
                    'info': 'Etapas del desarrollo',
                    'tags': ['level0'],
                    'pieces': [
                        {
                            'info': '0-6, embrión psíquico/espiritual',
                            'tags': ['level0'],
                            'pieces': [
                                {
                                    'info': 'Movimiento, lenguaje, pensamiento, personalidad.',
                                    'tags': ['level1'],
                                },
                                {
                                    'info': 'Desarrollo cerebral y recimiento físico.',
                                    'tags': ['level1'],
                                },
                                {
                                    'info': '0-3',
                                    'tags': ['level0'],
                                    'pieces': [
                                        {
                                            'info': '“La formación del hombre”',
                                            'tags': ['level0'],
                                        },
                                        {
                                            'info': [
                                                'Es una etapa de crecimiento y absorción.',
                                                'El niño necesita experiencias concretas que le permitan movimientoy exploración sensorial y que esté en contacto con la realidad.',
                                                'Comportamiento por imitación.',
                                                'Momento en el que la mente absorbente es inconsciente.'
                                            ],
                                            'tags': ['level1'],
                                        }
                                    ]
                                },
                                {
                                    'info': '3-6',
                                    'tags': ['level0'],
                                    'pieces': [
                                        {
                                            'info': '“La construcción de la mente consciente”',
                                            'tags': ['level0'],
                                        },
                                        {
                                            'info': [
                                                'Período en el que el consciente está en proceso de ser formado.',
                                                'Momento de la consolidación y perfeccionamiento de las habilidades ya adquiridas.',
                                                'Desarrollo de las funciones que fueron creadas en la etapa de 0-3.',
                                                'Trabajando en su autonomía.'
                                            ],
                                            'tags': ['level1'],
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            'info': '6-12, niñez / embrión social',
                            'tags': ['level0'],
                            'pieces': [
                                {
                                    'info': 'Abstracción, relaciones sociales, actividad organizada, intelecto, moral',
                                    'tags': ['level0'],
                                },
                                {
                                    'info': 'Estabilidad',
                                    'tags': ['level0'],
                                },
                                {
                                    'type': 'olist',
                                    'tags': ['level1'],
                                    'info': [
                                        'Buena salud',
                                        'Gran energía',
                                        'No hay grandes transformaciones físicas, el esqueleto se calcifica.',
                                        'Es común que no se interesen por el orden, ni por el aseo personal',
                                        'Desarrollo de una mente razonadora, estableciendo relaciones, notando patrones, haciendo sus propios juicios (justo o no; correcto o no).',
                                        'Interés por la cultura, explorar y conocer el mundo.',
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        };


        class Piece {

            static TYPES = {
                'PIECE': 'piece',
                'PARAGRAPH': 'paragraph',
                'LIST': 'list',
                'OLIST': 'olist',
                'IMAGE': 'image',
            };

            static parse({ info, pieces = [], type, tags = [] } = [], level = 0) {

                const parsedType = type ? type : (pieces && pieces.length > 0)
                    ? Piece.TYPES.PIECE
                    : (Array.isArray(info))
                        ? Piece.TYPES.LIST
                        : Piece.TYPES.PARAGRAPH;

                const parsedPieces = pieces.map(p => Piece.parse(p, level + 1));
                return new Piece({ info, 'pieces': parsedPieces, 'type': parsedType, tags, level });
            }

            #type
            #info
            #tags
            #pieces
            #level

            constructor({ info = null, pieces = [], type = Piece.TYPES.PIECE, tags = [], level = 0 } = {}) {

                this.#info = info;
                this.#pieces = pieces;
                this.#type = type;
                this.#tags = tags;
                this.#level = level;
            }

            get type() { return this.#type; }
            get info() { return this.#info; }
            get tags() { return this.#tags; }
            get pieces() { return this.#pieces; }
            get level() { return this.#level; }
        }


        const piece = Piece.parse(info);
        console.log(piece);

        function printPiece(piece, parent) {


            let element = null;
            switch (piece.type) {
                case Piece.TYPES.PIECE: {
                    element = document.createElement(`h${piece.level + 1}`);
                    element.textContent = piece.info;
                    parent.appendChild(element);
                    piece.pieces.forEach(p => printPiece(p, parent));
                    break;
                }
                case Piece.TYPES.PARAGRAPH: {
                    element = document.createElement('p');
                    element.textContent = piece.info;
                    parent.appendChild(element);
                    break;
                }
                case Piece.TYPES.LIST:
                case Piece.TYPES.OLIST: {

                    element = document.createElement(piece.type == Piece.TYPES.OLIST ? 'ol' : 'ul');
                    piece.info.forEach(
                        (i) => {
                            const li = document.createElement('li');
                            li.textContent = i;
                            element.appendChild(li);
                        }
                    );
                    parent.appendChild(element);
                    break;
                }
                case Piece.TYPES.IMAGE: {
                    element = document.createElement('img');
                    element.setAttribute('src', piece.info);
                    parent.appendChild(element);

                    break;
                }
            }

            if (piece.tags.length) {
                element.setAttribute('data-tags', piece.tags.join(','));
            }
        }
        const body = document.querySelector('body');
        printPiece(piece, body);

        const leveled = document.querySelectorAll('[data-tags]');
        const h1 = document.querySelectorAll('h1');

        function updateView(threshold) {
            leveled.forEach(
                (l) => {
                    const { tags = '' } = l.dataset;
                    const tagsSet = new Set(tags.split(','));
                    const visible = Array.from({ length: threshold + 1 }, (_, index) => index).reduce(
                        (prev, curr) => {
                            return prev || tagsSet.has(`level${curr}`);
                        },
                        false
                    );
                    l.style['display'] = visible ? 'revert' : 'none';
                }
            );
        }

        const slider = document.createElement('input');
        slider.style['position'] = 'fixed';
        slider.style['top'] = '0';
        slider.style['left'] = '0';
        slider.setAttribute('type', 'range');
        slider.setAttribute('min', '0');
        slider.setAttribute('max', '3');
        slider.setAttribute('value', '0');
        slider.addEventListener('change',
            (evt) => {
                updateView(slider.value);
            }
        )
        body.appendChild(slider);

        updateView(slider.value);
    </script>
</body>

</html>